C51 COMPILER V9.60.7.0   MAIN                                                              03/01/2025 22:05:02 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\Main.obj
COMPILER INVOKED BY: D:\Program_Store\Application\KeilC\C51\BIN\C51.EXE Main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTE
                    -ND PRINT(.\Listings\Main.lst) TABS(2) OBJECT(.\Objects\Main.obj)

line level    source

   1          #include<REGX51.H>
   2          #include <Thu_Vien_LCD.h>
   3          
   4          #define CL P2_0  
   5          #define ST P2_1  // Muc 1 de chuyen doi
   6          #define EOC P2_2 // Xuat muc 1 khi chuyen doi ADC xong
   7          #define OE P2_3 // Muc 1 de doc gia tri Digital
   8          #define ALE P2_4 // chot cong IN0-7
   9          #define A P2_5 
  10          #define B P2_6 
  11          #define C P2_7 
  12          
  13          // khai báo Cho SRF04
  14          #define TRIG P1_0
  15          #define ECHO P1_1
  16          
  17          // khai bao nut nhan
  18          #define UP P1_2
  19          #define DOWN P1_3
  20          #define Select_Mode P1_4
  21          
  22          
  23          // các bien tinh nhiet do
  24          int kq; 
  25          int Set_Nhiet_Do=25;
  26          int i;
  27          
  28          // cac bien cho SRF
  29          int khoangcach, time, dem, convert_us;
  30          
  31          void delay(int ms){
  32   1        for(i=0;i<ms;i++){
  33   2        TMOD=0x01;
  34   2        TH0=0xFC;
  35   2        TL0=0x66;
  36   2        TR0=1;
  37   2        while(TF0==0);
  38   2        TR0=1;
  39   2        TF0=0;    
  40   2        }
  41   1      }
  42          
  43          
  44          void Clock(){
  45   1        CL=0;
  46   1        CL=1;
  47   1      }
  48          
  49          void IN_x(unsigned char ad){
  50   1      
  51   1        A = ad & 0x01;
  52   1        B = ad & 0x02;
  53   1        C = ad & 0x04;
  54   1      }
C51 COMPILER V9.60.7.0   MAIN                                                              03/01/2025 22:05:02 PAGE 2   

  55          
  56          unsigned char ADC_Read(unsigned char diachi){
  57   1       unsigned char ketqua;
  58   1      
  59   1        ST=1; //kich 1 xung 1 ve 0
  60   1        Clock();
  61   1        IN_x(diachi);// truyen dia chi chon IN
  62   1        ALE=1;//kich 1 xung 1 ve 0
  63   1        Clock();
  64   1        ALE=0;
  65   1        Clock();
  66   1        ST=0;
  67   1      
  68   1        while(EOC==0) Clock();
  69   1        OE=1;
  70   1        ketqua=P0;
  71   1        OE=0;
  72   1        
  73   1        return ketqua;
  74   1      }
  75          void readnhietdo(){
  76   1          LCD_Gotoxy(0,0);
  77   1          LCD_Puts(" Nhiet Do: ");    
  78   1          kq = ADC_Read(0);
  79   1          kq = (kq * 500) / 256;  // 500 = 5V * 100 (100°C = 1V)
  80   1          LCD_PutNumber(kq);
  81   1          LCD_Puts("'C  ");
  82   1      }
  83          
  84          int chonmode=0;
  85          
  86          void main() {
  87   1        
  88   1          LCD_Init();
  89   1          LCD_Clear();
  90   1          LCD_Gotoxy(3, 0);
  91   1          LCD_Puts("Chon Che Do");
  92   1          LCD_Gotoxy(4, 1);
  93   1          LCD_Puts("PhamHieuu");
  94   1        
  95   1          TMOD = 0x01;
  96   1          TH0=0x00;
  97   1          TL0=0x00;  
  98   1        
  99   1          while (1) {
 100   2            
 101   2            // CHON CHE DO 1 OR 2
 102   2            if(Select_Mode==0){
 103   3             chonmode=chonmode+1;
 104   3              delay(400);
 105   3               if(chonmode==3)
 106   3                 chonmode=1;
 107   3            }
 108   2            
 109   2            // CHE DO 1
 110   2            if(chonmode==1){
 111   3                readnhietdo();
 112   3                
 113   3                 if(UP==0){
 114   4                  LCD_Gotoxy(0, 1);
 115   4                  LCD_Puts(" Cai Dat: ");  
 116   4                  Set_Nhiet_Do=Set_Nhiet_Do+1;
C51 COMPILER V9.60.7.0   MAIN                                                              03/01/2025 22:05:02 PAGE 3   

 117   4                  LCD_PutNumber(Set_Nhiet_Do);
 118   4                  LCD_Puts(" 'C");   
 119   4                  delay(200);
 120   4                 }
 121   3                 else if(DOWN==0){
 122   4                  LCD_Gotoxy(0, 1);
 123   4                  LCD_Puts(" Cai Dat: ");  
 124   4                  Set_Nhiet_Do=Set_Nhiet_Do-1;
 125   4                  LCD_PutNumber(Set_Nhiet_Do);
 126   4                  LCD_Puts(" 'C");   
 127   4                  delay(200);}
 128   3                    
 129   3                 if(kq>=Set_Nhiet_Do){
 130   4                  P1_5=0;
 131   4                  }
 132   3                 else {
 133   4                  P1_5=1;
 134   4                }
 135   3            }
 136   2            
 137   2            // CHE DO 2
 138   2            else if(chonmode==2)
 139   2              {
 140   3                  P1_5=1;// tat het trang thai cua che do 1
 141   3                
 142   3                  TRIG = 1;
 143   3                  delay(10);
 144   3                  TRIG = 0;
 145   3                  
 146   3                  // tranh bi treo chuong trinh doi khi echo=1 thi moi thoat
 147   3                  if (ECHO==0){
 148   4                   TR0=0;
 149   4                   TH0=0x00;
 150   4                   TL0=0x00;
 151   4                   dem++;
 152   4                   while(ECHO==0){
 153   5                    if(dem<8)
 154   5                      break;
 155   5                   }
 156   4                  }
 157   3                  
 158   3                  if (ECHO==1){
 159   4                   TH0=TL0=0x00;
 160   4                   TR0=1;
 161   4                   while(ECHO==1);
 162   4                   TR0=0;
 163   4                  }
 164   3                  
 165   3                  time= TH0*256+TL0; //Chuyen TH0 và TL0 tu he hexa sang decimal
 166   3                  convert_us= time*1.058;// chuyen time sang don vi us
 167   3                  khoangcach= convert_us/58; // khoangcach= (Tocdo*convert_us)/2 
 168   3                  
 169   3                  // sai so trong thuc te
 170   3                  if(khoangcach>=3 && khoangcach<=5) khoangcach++;
 171   3                  if(khoangcach>=24 && khoangcach<=41) khoangcach--;
 172   3                  if(khoangcach>=42 && khoangcach<=59) khoangcach =  khoangcach - 2;
 173   3                  if(khoangcach>=60 && khoangcach<=77) khoangcach =  khoangcach - 3;
 174   3                  
 175   3                  LCD_Gotoxy(0,0);
 176   3                  LCD_Puts("  DO DAI: ");
 177   3                  LCD_PutNumber(khoangcach);
 178   3                  LCD_Puts("CM    ");
C51 COMPILER V9.60.7.0   MAIN                                                              03/01/2025 22:05:02 PAGE 4   

 179   3                  LCD_Gotoxy(0, 1);
 180   3                  LCD_Puts("    PhamHieuu   ");
 181   3              }
 182   2            }
 183   1           }
 184          
 185          
 186          
 187          
 188          
 189          
 190          
 191          
 192          
 193          
 194          
 195          
 196          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    670    ----
   CONSTANT SIZE    =     89    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
